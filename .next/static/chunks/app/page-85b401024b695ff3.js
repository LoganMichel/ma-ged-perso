(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4810:function(e,t,s){Promise.resolve().then(s.bind(s,789))},789:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ek}});var a=s(7437),l=s(2265),n=s(2720),r=s(6595),i=s(8728),c=s(5685),d=s(9397),o=s(875),m=s(9465),x=s(8964),u=s(7689),h=s(2735),p=s(8930),g=s(7168),j=s(3247),f=s(1817),b=s(2489),N=s(7586),v=s(3468),w=s(8400),y=s(141),k=s(1837);function Z(){let{state:e,dispatch:t,actions:s}=(0,y.q)(),[Z,C]=(0,l.useState)(""),[S,A]=(0,l.useState)(!1),D=(0,l.useRef)(null),E=(0,l.useRef)(null);(0,l.useEffect)(()=>(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{s.search(Z)},300),()=>{D.current&&clearTimeout(D.current)}),[Z]),(0,l.useEffect)(()=>{let e=e=>{E.current&&!E.current.contains(e.target)&&A(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let I=e=>{t({type:"SET_VIEW_MODE",payload:e})},O=()=>{C(""),s.clearSearch()},_=e=>{A(!1),t({type:"SHOW_MODAL",payload:{type:"create",data:{itemType:e}}})},L=t=>{switch(t){case"armoire":return!0;case"rayon":return!!e.selection.armoire;case"classeur":return!!e.selection.rayon;case"dossier":return!!e.selection.classeur;case"intercalaire":return!!e.selection.dossier;default:return!1}},F=e.intercalaires&&e.intercalaires.length>0,T=!!(e.selection.intercalaire||e.selection.dossier&&!F),M=!!(e.selection.document||e.selection.intercalaire||e.selection.dossier||e.selection.classeur||e.selection.rayon||e.selection.armoire);return(0,a.jsxs)("header",{className:"bg-white border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 md:px-4 py-2 bg-gradient-to-r from-ged-primary to-ged-secondary",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 md:gap-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("img",{src:"/logo-ged-blanc.png",alt:"GED",className:"w-7 h-7 md:w-8 md:h-8"}),(0,a.jsxs)("h1",{className:"text-white font-display font-bold text-lg md:text-xl tracking-tight",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Ma GED"}),(0,a.jsx)("span",{className:"sm:hidden",children:"GED"}),(0,a.jsx)("span",{className:"font-light opacity-80 hidden sm:inline",children:" Perso"})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 md:gap-2",children:[(0,a.jsx)("button",{onClick:()=>t({type:"SHOW_MODAL",payload:{type:"manageTags"}}),className:"p-1.5 md:p-2 rounded-md text-white/80 hover:text-white hover:bg-white/10 transition-colors",title:"G\xe9rer les \xe9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("show-mobile-favorites"))},className:"p-1.5 md:p-2 rounded-md text-white/80 hover:text-white hover:bg-white/10 transition-colors md:hidden relative",title:"Favoris",children:[(0,a.jsx)(r.Z,{className:"w-5 h-5"}),e.favorites.length>0&&(0,a.jsx)("span",{className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-amber-500 rounded-full text-[10px] flex items-center justify-center font-bold",children:e.favorites.length})]}),(0,a.jsx)("button",{className:"p-1.5 md:p-2 rounded-md text-white/80 hover:text-white hover:bg-white/10 transition-colors hidden md:block",children:(0,a.jsx)(i.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-1.5 md:p-2 rounded-md text-white/80 hover:text-white hover:bg-white/10 transition-colors hidden md:block",children:(0,a.jsx)(c.Z,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"toolbar flex-col md:flex-row",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 w-full md:w-auto",children:[(0,a.jsxs)("div",{className:"relative",ref:E,children:[(0,a.jsxs)("button",{onClick:()=>A(!S),className:"btn btn-primary text-sm",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Nouveau"}),(0,a.jsx)(o.Z,{className:"w-3 h-3 ml-1"})]}),S&&(0,a.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-white rounded-lg shadow-dropdown border border-ged-border py-1 min-w-[180px] z-50 animate-fade-in",children:[(0,a.jsxs)("button",{onClick:()=>_("armoire"),className:"context-menu-item w-full text-left",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-ged-accent"}),"Nouvelle armoire"]}),(0,a.jsxs)("button",{onClick:()=>_("rayon"),className:"context-menu-item w-full text-left ".concat(L("rayon")?"":"opacity-50 cursor-not-allowed"),disabled:!L("rayon"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-ged-secondary"}),"Nouveau rayon"]}),(0,a.jsxs)("button",{onClick:()=>_("classeur"),className:"context-menu-item w-full text-left ".concat(L("classeur")?"":"opacity-50 cursor-not-allowed"),disabled:!L("classeur"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-ged-primary"}),"Nouveau classeur"]}),(0,a.jsxs)("button",{onClick:()=>_("dossier"),className:"context-menu-item w-full text-left ".concat(L("dossier")?"":"opacity-50 cursor-not-allowed"),disabled:!L("dossier"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-purple-500"}),"Nouveau dossier"]}),(0,a.jsxs)("button",{onClick:()=>_("intercalaire"),className:"context-menu-item w-full text-left ".concat(L("intercalaire")?"":"opacity-50 cursor-not-allowed"),disabled:!L("intercalaire"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-pink-500"}),"Nouvel intercalaire"]}),(0,a.jsx)("div",{className:"context-menu-separator"}),(0,a.jsxs)("button",{onClick:()=>{A(!1),t({type:"SHOW_MODAL",payload:{type:"upload"}})},className:"context-menu-item w-full text-left ".concat(T?"":"opacity-50 cursor-not-allowed"),disabled:!T,children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 text-green-500"}),"Ajouter un document"]})]})]}),(0,a.jsx)("div",{className:"w-px h-6 bg-ged-border mx-2"}),(0,a.jsx)("button",{className:"toolbar-btn",onClick:()=>t({type:"SHOW_MODAL",payload:{type:"upload"}}),title:"Importer des fichiers",disabled:!T,children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"toolbar-btn",title:"T\xe9l\xe9charger",disabled:!e.selection.document,onClick:()=>{if(e.selection.document){let t=(0,k.km)(e.selection.document.id);window.open(t,"_blank")}},children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"toolbar-btn ".concat(M?"text-red-500 hover:text-red-600 hover:bg-red-50":""),title:"Supprimer",disabled:!M,onClick:()=>{let{selection:s}=e,a=null,l="";s.document?(a=s.document,l="document"):s.intercalaire?(a=s.intercalaire,l="intercalaire"):s.dossier?(a=s.dossier,l="dossier"):s.classeur?(a=s.classeur,l="classeur"):s.rayon?(a=s.rayon,l="rayon"):s.armoire&&(a=s.armoire,l="armoire"),a&&t({type:"SHOW_MODAL",payload:{type:"delete",data:{itemId:a.id,itemName:a.name,level:l}}})},children:(0,a.jsx)(p.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"w-px h-6 bg-ged-border mx-2"}),(0,a.jsx)("button",{className:"toolbar-btn",title:"Actualiser",onClick:s.refresh,children:(0,a.jsx)(g.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"hidden md:block flex-1"})]}),(0,a.jsx)("div",{className:"w-full md:hidden mt-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-ged-text-muted"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher dans la GED...",value:Z,onChange:e=>C(e.target.value),className:"input pl-9 pr-10 py-2.5 w-full text-base ".concat(e.isSearchActive?"ring-2 ring-ged-secondary border-ged-secondary":"")}),e.searchLoading&&(0,a.jsx)(f.Z,{className:"absolute right-8 top-1/2 -translate-y-1/2 w-4 h-4 text-ged-secondary animate-spin"}),Z&&(0,a.jsx)("button",{onClick:O,className:"absolute right-3 top-1/2 -translate-y-1/2 text-ged-text-muted hover:text-ged-text p-1",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]})}),(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-ged-text-muted"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher...",value:Z,onChange:e=>C(e.target.value),className:"input pl-9 pr-10 py-1.5 w-72 text-sm ".concat(e.isSearchActive?"ring-2 ring-ged-secondary border-ged-secondary":"")}),e.searchLoading&&(0,a.jsx)(f.Z,{className:"absolute right-8 top-1/2 -translate-y-1/2 w-4 h-4 text-ged-secondary animate-spin"}),Z&&(0,a.jsx)("button",{onClick:O,className:"absolute right-3 top-1/2 -translate-y-1/2 text-ged-text-muted hover:text-ged-text",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-6 bg-ged-border"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-ged-surface-alt rounded-md p-0.5",children:[(0,a.jsx)("button",{onClick:()=>I("list"),className:"p-1.5 rounded transition-colors ".concat("list"===e.viewMode?"bg-white shadow-sm text-ged-primary":"text-ged-text-muted hover:text-ged-text"),title:"Vue liste",children:(0,a.jsx)(N.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>I("grid"),className:"p-1.5 rounded transition-colors ".concat("grid"===e.viewMode?"bg-white shadow-sm text-ged-primary":"text-ged-text-muted hover:text-ged-text"),title:"Vue grille",children:(0,a.jsx)(v.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>I("details"),className:"p-1.5 rounded transition-colors ".concat("details"===e.viewMode?"bg-white shadow-sm text-ged-primary":"text-ged-text-muted hover:text-ged-text"),title:"Vue d\xe9taill\xe9e",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]})]})]})]})}var C=s(1239),S=s(407),A=s(1723);function D(){let{state:e,dispatch:t,actions:s}=(0,y.q)(),[i,c]=(0,l.useState)(!0),[m,x]=(0,l.useState)(!0),[u,h]=(0,l.useState)(!0),[p,g]=(0,l.useState)(null),N=e=>{s.filterByTag(e)},v=e=>{s.selectDocument(e),window.dispatchEvent(new CustomEvent("open-document-preview",{detail:e}))},w=(e,t)=>{e.stopPropagation(),s.removeFavorite(t)};return e.sidebarCollapsed?(0,a.jsxs)("aside",{className:"sidebar w-12 bg-white border-r border-ged-border flex-col items-center py-4 gap-3 hidden md:flex",children:[(0,a.jsx)("button",{className:"p-2 rounded-md text-ged-text-muted hover:text-ged-primary hover:bg-ged-surface-alt transition-colors",children:(0,a.jsx)(C.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 rounded-md text-amber-500 hover:bg-amber-50 transition-colors",children:(0,a.jsx)(r.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 rounded-md text-ged-text-muted hover:text-ged-primary hover:bg-ged-surface-alt transition-colors",children:(0,a.jsx)(n.Z,{className:"w-5 h-5"})})]}):(0,a.jsxs)("aside",{className:"sidebar w-56 bg-white border-r border-ged-border flex-col hidden md:flex",children:[(0,a.jsxs)("div",{className:"panel-header flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"Scripts"]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("button",{onClick:()=>c(!i),className:"flex items-center gap-1 w-full px-2 py-1 text-xs font-medium text-ged-text-muted uppercase tracking-wider hover:text-ged-primary transition-colors",children:[i?(0,a.jsx)(o.Z,{className:"w-3 h-3"}):(0,a.jsx)(S.Z,{className:"w-3 h-3"}),"Actions rapides"]}),i&&(0,a.jsxs)("div",{className:"mt-1 space-y-0.5",children:[(0,a.jsxs)("button",{onClick:()=>{g("search");let e=document.querySelector('input[placeholder="Rechercher..."]');e&&e.focus()},className:"tree-item w-full text-left text-sm ".concat("search"===p?"selected":""),children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 text-ged-primary"}),(0,a.jsx)("span",{className:"truncate",children:"Recherche avanc\xe9e"})]}),(0,a.jsxs)("button",{onClick:()=>{g("recent"),s.search("")},className:"tree-item w-full text-left text-sm ".concat("recent"===p?"selected":""),children:[(0,a.jsx)(A.Z,{className:"w-4 h-4 text-ged-secondary"}),(0,a.jsx)("span",{className:"truncate",children:"Documents r\xe9cents"})]})]})]}),(0,a.jsx)("div",{className:"border-t border-ged-border my-2"}),(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("button",{onClick:()=>x(!m),className:"flex items-center gap-1 w-full px-2 py-1 text-xs font-medium text-ged-text-muted uppercase tracking-wider hover:text-ged-primary transition-colors",children:[m?(0,a.jsx)(o.Z,{className:"w-3 h-3"}):(0,a.jsx)(S.Z,{className:"w-3 h-3"}),(0,a.jsx)(r.Z,{className:"w-3 h-3 text-amber-500"}),"Favoris",e.favorites.length>0&&(0,a.jsx)("span",{className:"ml-auto text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded-full",children:e.favorites.length})]}),m&&(0,a.jsx)("div",{className:"mt-1 space-y-0.5",children:0===e.favorites.length?(0,a.jsx)("div",{className:"px-2 py-3 text-xs text-ged-text-muted text-center",children:"Aucun favori"}):e.favorites.map(e=>(0,a.jsxs)("button",{onClick:()=>v(e),className:"tree-item w-full text-left text-sm group",children:[(0,a.jsx)(r.Z,{className:"w-4 h-4 text-amber-500 fill-amber-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate flex-1",children:e.name}),(0,a.jsx)("button",{onClick:t=>w(t,e.id),className:"p-0.5 rounded opacity-0 group-hover:opacity-100 text-ged-text-muted hover:text-red-500 hover:bg-red-50 transition-all",title:"Retirer des favoris",children:(0,a.jsx)(b.Z,{className:"w-3 h-3"})})]},e.id))})]}),(0,a.jsx)("div",{className:"border-t border-ged-border my-2"}),(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("button",{onClick:()=>h(!u),className:"flex items-center gap-1 w-full px-2 py-1 text-xs font-medium text-ged-text-muted uppercase tracking-wider hover:text-ged-primary transition-colors",children:[u?(0,a.jsx)(o.Z,{className:"w-3 h-3"}):(0,a.jsx)(S.Z,{className:"w-3 h-3"}),"\xc9tiquettes"]}),u&&(0,a.jsxs)("div",{className:"mt-1 space-y-0.5",children:[e.loading.tags?(0,a.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin text-ged-secondary"})}):0===e.availableTags.length?(0,a.jsx)("div",{className:"px-2 py-3 text-xs text-ged-text-muted text-center",children:"Aucune \xe9tiquette"}):e.availableTags.map(e=>(0,a.jsxs)("button",{onClick:()=>N(e.name),className:"tree-item w-full text-left text-sm justify-between group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"truncate",children:e.name})]}),(0,a.jsx)("span",{className:"text-xs bg-ged-surface-alt px-1.5 py-0.5 rounded-full text-ged-text-muted",children:e.count})]},e.name)),(0,a.jsxs)("button",{onClick:()=>t({type:"SHOW_MODAL",payload:{type:"manageTags"}}),className:"tree-item w-full text-left text-sm text-ged-text-muted hover:text-ged-primary",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"G\xe9rer les \xe9tiquettes..."})]})]})]})]}),(0,a.jsx)("div",{className:"p-3 border-t border-ged-border bg-ged-surface/50",children:(0,a.jsxs)("div",{className:"text-xs text-ged-text-muted space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Connexion API"}),(0,a.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(e.apiConnected?"bg-green-500":"bg-red-500")})]}),(0,a.jsx)("div",{className:"text-[10px] opacity-75",children:e.apiConnected?"/volume1/GED":"D\xe9connect\xe9"})]})})]})}var E=s(9658),I=s(8736),O=s(3113),_=s(9857),L=s(1649),F=s(9334),T=s(4924),M=s(9548),R=s(9322),q=s(2451),z=s(8893),P=s(6362);let H=["@eaDir","#recycle",".DS_Store","Thumbs.db","@tmp","#snapshot"];function W(e){return e.filter(e=>{let t=e.name.toLowerCase();return!H.some(e=>t===e.toLowerCase()||t.startsWith(e.toLowerCase()))})}let U=e=>{if(!e)return(0,a.jsx)(E.Z,{className:"w-4 h-4 text-gray-400"});let t=e.toLowerCase();return({pdf:(0,a.jsx)(I.Z,{className:"w-4 h-4 text-red-500"}),jpg:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-blue-500"}),jpeg:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-blue-500"}),png:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-blue-500"}),gif:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-blue-500"}),webp:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-blue-500"}),doc:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-blue-600"}),docx:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-blue-600"}),xls:(0,a.jsx)(L.Z,{className:"w-4 h-4 text-green-600"}),xlsx:(0,a.jsx)(L.Z,{className:"w-4 h-4 text-green-600"}),zip:(0,a.jsx)(F.Z,{className:"w-4 h-4 text-amber-600"}),rar:(0,a.jsx)(F.Z,{className:"w-4 h-4 text-amber-600"})})[t]||(0,a.jsx)(E.Z,{className:"w-4 h-4 text-gray-400"})},G=e=>{if(!e)return(0,a.jsx)(E.Z,{className:"w-12 h-12 text-gray-400"});let t=e.toLowerCase();return({pdf:(0,a.jsx)(I.Z,{className:"w-12 h-12 text-red-500"}),jpg:(0,a.jsx)(O.Z,{className:"w-12 h-12 text-blue-500"}),jpeg:(0,a.jsx)(O.Z,{className:"w-12 h-12 text-blue-500"}),png:(0,a.jsx)(O.Z,{className:"w-12 h-12 text-blue-500"}),gif:(0,a.jsx)(O.Z,{className:"w-12 h-12 text-blue-500"}),webp:(0,a.jsx)(O.Z,{className:"w-12 h-12 text-blue-500"}),doc:(0,a.jsx)(_.Z,{className:"w-12 h-12 text-blue-600"}),docx:(0,a.jsx)(_.Z,{className:"w-12 h-12 text-blue-600"}),xls:(0,a.jsx)(L.Z,{className:"w-12 h-12 text-green-600"}),xlsx:(0,a.jsx)(L.Z,{className:"w-12 h-12 text-green-600"}),zip:(0,a.jsx)(F.Z,{className:"w-12 h-12 text-amber-600"}),rar:(0,a.jsx)(F.Z,{className:"w-12 h-12 text-amber-600"})})[t]||(0,a.jsx)(E.Z,{className:"w-12 h-12 text-gray-400"})};function V(e){var t,s;let{item:l,onPreview:i}=e,{state:c,dispatch:d,actions:o}=(0,y.q)(),m=o.isFavorite(l.id),x=l.tags&&0!==l.tags.length?l.tags.slice(0,3).map(e=>{let t=c.availableTags.find(t=>t.name===e);return{name:e,color:(null==t?void 0:t.color)||"#3b82f6"}}):[],u=l.tags&&l.tags.length>3;return(0,a.jsxs)("div",{className:"list-item group cursor-pointer hover:bg-ged-surface",onClick:()=>{"document"===l.type&&i(l)},children:["document"===l.type?U(l.extension):(0,a.jsx)(T.Z,{className:"w-4 h-4 text-ged-accent"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"truncate text-sm font-medium",children:l.name}),(null===(t=l.match_type)||void 0===t?void 0:t.includes("filename"))&&(0,a.jsx)("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-medium flex-shrink-0",children:"Titre"}),(null===(s=l.match_type)||void 0===s?void 0:s.includes("content"))&&(0,a.jsx)("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded font-medium flex-shrink-0",children:"Contenu"}),x.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[x.map(e=>(0,a.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color},title:e.name},e.name)),u&&(0,a.jsxs)("span",{className:"text-[10px] text-ged-text-muted",children:["+",l.tags.length-3]})]})]}),(0,a.jsx)("div",{className:"text-xs text-ged-text-muted truncate",children:l.path})]}),(0,a.jsx)("span",{className:"text-xs bg-ged-surface-alt px-2 py-0.5 rounded text-ged-text-muted mr-2",children:l.type}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:["document"===l.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),m?o.removeFavorite(l.id):o.addFavorite(l)},className:"p-1 rounded hover:bg-ged-surface-alt ".concat(m?"text-amber-500":"text-ged-text-muted hover:text-amber-500"),title:m?"Retirer des favoris":"Ajouter aux favoris",children:(0,a.jsx)(r.Z,{className:"w-4 h-4 ".concat(m?"fill-current":"")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o.selectDocument(l),d({type:"SHOW_MODAL",payload:{type:"tags"}})},className:"p-1 rounded text-ged-text-muted hover:text-ged-accent hover:bg-ged-surface-alt",title:"\xc9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:l.id,itemName:l.name}}})},className:"p-1 rounded text-ged-text-muted hover:text-blue-500 hover:bg-blue-50",title:"D\xe9placer",children:(0,a.jsx)(M.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation();let t=(0,k.km)(l.id,c.activeUrl||void 0);window.open(t,"_blank")},className:"p-1 rounded text-ged-text-muted hover:text-ged-secondary hover:bg-ged-surface-alt",title:"T\xe9l\xe9charger",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d({type:"SHOW_MODAL",payload:{type:"delete",data:{itemId:l.id,itemName:l.name,level:l.type}}})},className:"p-1 rounded text-ged-text-muted hover:text-red-500 hover:bg-red-50",title:"Supprimer",children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]})]})}function $(e){var t,s;let{item:l,onPreview:n}=e,{state:i,dispatch:c,actions:d}=(0,y.q)(),o=d.isFavorite(l.id);return(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 bg-white active:bg-ged-surface",onClick:()=>{"document"===l.type&&n(l)},children:["document"===l.type?U(l.extension):(0,a.jsx)(T.Z,{className:"w-5 h-5 text-ged-accent flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm truncate",children:l.name}),(null===(t=l.match_type)||void 0===t?void 0:t.includes("filename"))&&(0,a.jsx)("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-medium flex-shrink-0",children:"Titre"}),(null===(s=l.match_type)||void 0===s?void 0:s.includes("content"))&&(0,a.jsx)("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded font-medium flex-shrink-0",children:"Contenu"})]}),(0,a.jsx)("div",{className:"text-xs text-ged-text-muted truncate",children:l.path})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:["document"===l.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o?d.removeFavorite(l.id):d.addFavorite(l)},className:"p-2 rounded-full ".concat(o?"text-amber-500":"text-ged-text-muted"),children:(0,a.jsx)(r.Z,{className:"w-5 h-5 ".concat(o?"fill-current":"")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:l.id,itemName:l.name}}})},className:"p-2 rounded-full text-ged-text-muted hover:text-blue-500",children:(0,a.jsx)(M.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation();let t=(0,k.km)(l.id,i.activeUrl||void 0);window.open(t,"_blank")},className:"p-2 rounded-full text-ged-text-muted",children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)(S.Z,{className:"w-5 h-5 text-ged-border"})]})]})}function B(e){let{title:t,items:s,selectedId:l,onSelect:n,loading:r=!1,emptyMessage:i="Aucun \xe9l\xe9ment",folderColor:c="text-ged-accent"}=e;return(0,a.jsxs)("div",{className:"flex flex-col min-w-[180px] max-w-[220px] border-r border-ged-border bg-white flex-shrink-0",children:[(0,a.jsxs)("div",{className:"column-header",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)("span",{className:"text-[10px] font-normal text-ged-text-muted",children:s.length})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:r?(0,a.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,a.jsx)(f.Z,{className:"w-5 h-5 animate-spin text-ged-secondary"})}):0===s.length?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-ged-text-muted",children:i}):s.map(e=>(0,a.jsxs)("div",{onClick:()=>n(e),className:"list-item group ".concat(l===e.id?"selected":""),children:["document"===e.type?U(e.extension):(0,a.jsx)(T.Z,{className:"w-4 h-4 ".concat(l===e.id?"text-white":c)}),(0,a.jsx)("span",{className:"flex-1 truncate text-sm",children:e.name}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation();let s=new CustomEvent("open-move-modal",{detail:{itemId:e.id,itemName:e.name}});window.dispatchEvent(s)},className:"p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity ".concat(l===e.id?"text-white/70 hover:text-white hover:bg-white/20":"text-ged-text-muted hover:text-blue-500 hover:bg-blue-50"),title:"D\xe9placer",children:(0,a.jsx)(M.Z,{className:"w-3 h-3"})}),void 0!==e.children_count&&e.children_count>0&&(0,a.jsx)(S.Z,{className:"w-3 h-3 ".concat(l===e.id?"text-white/70":"text-ged-text-muted")})]},e.id))})]})}function K(){var e,t,s,n,i,c,d,o;let{state:m,actions:x,dispatch:u}=(0,y.q)(),{selection:h,armoires:p,rayons:g,classeurs:b,dossiers:N,intercalaires:v,documents:w,loading:k,apiConnected:Z,apiChecking:C,isSearchActive:A,searchResults:D,searchLoading:E,viewMode:O}=m,[_,L]=(0,l.useState)(!1),F=function(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=()=>t(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),[T,M]=(0,l.useState)(0),z=W(p),P=W(g),H=W(b),U=W(N),G=W(v),K=W(w),et=W(D),[es,ea]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>ea(!0);return window.addEventListener("show-mobile-favorites",e),()=>window.removeEventListener("show-mobile-favorites",e)},[]),(0,l.useEffect)(()=>{let e=e=>{L(!0)};return window.addEventListener("open-document-preview",e),()=>window.removeEventListener("open-document-preview",e)},[]),(0,l.useEffect)(()=>{let e=e=>{let{itemId:t,itemName:s}=e.detail;u({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:t,itemName:s}}})};return window.addEventListener("open-move-modal",e),()=>window.removeEventListener("open-move-modal",e)},[]);let el=G.length>0,er=[{id:"armoire",title:"ARMOIRE",color:"text-ged-accent"},{id:"rayon",title:"RAYON",color:"text-ged-secondary"},{id:"classeur",title:"CLASSEUR",color:"text-ged-primary"},{id:"dossier",title:"DOSSIER",color:"text-purple-500"},...el?[{id:"intercalaire",title:"INTERCALAIRE",color:"text-pink-500"}]:[],{id:"documents",title:"DOCUMENTS",color:"text-gray-600"}],ei=()=>h.document||el&&h.intercalaire||!el&&h.dossier?er.length-1:el&&h.dossier?er.findIndex(e=>"intercalaire"===e.id):h.classeur?3:h.rayon?2:h.armoire?1:0;(0,l.useEffect)(()=>{if(F){let e=ei();T<e&&M(e)}},[h.armoire,h.rayon,h.classeur,h.dossier,h.intercalaire,el]);let ec=e=>{x.selectDocument(e),L(!0)};if(C)return(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-ged-surface-alt",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(f.Z,{className:"w-8 h-8 animate-spin text-ged-secondary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-ged-text-muted",children:"Connexion \xe0 l'API..."})]})});if(!Z)return(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-ged-surface-alt",children:(0,a.jsxs)("div",{className:"text-center max-w-md p-6",children:[(0,a.jsx)(R.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-ged-text mb-2",children:"API non connect\xe9e"}),(0,a.jsx)("p",{className:"text-ged-text-muted mb-4",children:"Impossible de se connecter \xe0 l'API GED. V\xe9rifiez que le conteneur Docker est lanc\xe9 sur votre NAS."}),(0,a.jsx)("code",{className:"block bg-ged-surface p-3 rounded text-sm text-left mb-4",children:(null===(o=window.__ENV__)||void 0===o?void 0:null===(d=o.API_URLS)||void 0===d?void 0:d[0])||"http://192.168.0.100:8001"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"R\xe9essayer"})]})});if(A)return F?(0,a.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden bg-ged-surface-alt",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 bg-white border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-ged-secondary"}),(0,a.jsx)("span",{className:"font-semibold text-sm text-ged-secondary",children:"R\xc9SULTATS"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-ged-text-muted",children:[et.length," r\xe9sultat(s)"]}),(0,a.jsx)("button",{onClick:x.clearSearch,className:"text-xs text-ged-secondary font-medium px-2 py-1 rounded hover:bg-ged-surface",children:"Effacer"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:E?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===et.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted p-8",children:[(0,a.jsx)(j.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Aucun r\xe9sultat trouv\xe9"})]}):(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:et.map(e=>(0,a.jsx)($,{item:e,onPreview:e=>{x.selectDocument(e),L(!0)}},e.id))})}),(0,a.jsx)(X,{selection:h,hasIntercalaires:el,armoires:z,documents:K}),_&&h.document&&(0,a.jsx)(Q,{document:h.document,onClose:()=>L(!1)})]}):(0,a.jsxs)("div",{className:"flex-1 bg-white flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"column-header justify-between",children:[(0,a.jsx)("span",{children:"R\xc9SULTATS DE RECHERCHE"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-[10px] font-normal text-ged-text-muted",children:[et.length," r\xe9sultat(s)"]}),(0,a.jsx)("button",{onClick:x.clearSearch,className:"text-xs text-ged-secondary hover:underline",children:"Effacer"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:E?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===et.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted p-8",children:[(0,a.jsx)(j.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Aucun r\xe9sultat trouv\xe9"})]}):(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:et.map(e=>(0,a.jsx)(V,{item:e,onPreview:e=>{x.selectDocument(e),L(!0)}},e.id))})}),_&&h.document&&(0,a.jsx)(en,{document:h.document,onClose:()=>L(!1)})]});if(F){let e=er[T],t=ei();return es?(0,a.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden bg-ged-surface-alt",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 bg-white border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"w-5 h-5 text-amber-500 fill-amber-500"}),(0,a.jsx)("span",{className:"font-semibold text-sm text-amber-600",children:"FAVORIS"})]}),(0,a.jsx)("button",{onClick:()=>ea(!1),className:"text-xs text-ged-primary font-medium px-2 py-1 rounded hover:bg-ged-surface",children:"Retour"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:0===m.favorites.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted p-8",children:[(0,a.jsx)(r.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Aucun favori"}),(0,a.jsxs)("p",{className:"text-xs text-center mt-2",children:["Ajoutez des documents aux favoris",(0,a.jsx)("br",{}),"pour y acc\xe9der rapidement"]})]}):(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:m.favorites.map(e=>(0,a.jsx)($,{item:e,onPreview:e=>{x.selectDocument(e),L(!0)}},e.id))})}),(0,a.jsx)(X,{selection:h,hasIntercalaires:el,armoires:z,documents:K}),_&&h.document&&(0,a.jsx)(Q,{document:h.document,onClose:()=>L(!1)})]}):(0,a.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden bg-ged-surface-alt",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between px-2 py-2 bg-white border-b border-ged-border",children:[(0,a.jsx)("button",{onClick:()=>{T>0&&M(T-1)},disabled:0===T,className:"p-2 rounded-lg flex-shrink-0 w-10 ".concat(0===T?"text-gray-300":"text-ged-primary active:bg-ged-surface"),children:(0,a.jsx)(q.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"flex-1 text-center min-w-0 px-1",children:[(0,a.jsx)("div",{className:"font-semibold text-sm ".concat((null==e?void 0:e.color)||""),children:null==e?void 0:e.title}),(0,a.jsx)("div",{className:"text-xs text-ged-text-muted truncate text-center px-2",children:(()=>{var e,t,s,a,l;let n=[null===(e=h.armoire)||void 0===e?void 0:e.name,null===(t=h.rayon)||void 0===t?void 0:t.name,null===(s=h.classeur)||void 0===s?void 0:s.name,null===(a=h.dossier)||void 0===a?void 0:a.name,el&&(null===(l=h.intercalaire)||void 0===l?void 0:l.name)].filter(Boolean);return 0===n.length?"Accueil":n.length<=3?n.join(" > "):"".concat(n[0]," > ... > ").concat(n[n.length-1])})()})]}),(0,a.jsx)("button",{onClick:()=>{T<ei()&&M(T+1)},disabled:T>=t,className:"p-2 rounded-lg flex-shrink-0 w-10 ".concat(T>=t?"text-gray-300":"text-ged-primary active:bg-ged-surface"),children:(0,a.jsx)(S.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"flex-shrink-0 flex gap-1 px-4 py-2 bg-white border-b border-ged-border",children:er.map((e,s)=>(0,a.jsx)("button",{onClick:()=>s<=t&&M(s),className:"flex-1 h-1 rounded-full transition-colors ".concat(s===T?"bg-ged-primary":s<=t?"bg-ged-border hover:bg-ged-text-muted":"bg-ged-surface")},e.id))}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(()=>{var t,s,l,n,r;switch(null==e?void 0:e.id){case"armoire":return(0,a.jsx)(Y,{items:z,selectedId:(null===(t=h.armoire)||void 0===t?void 0:t.id)||null,onSelect:e=>{x.selectArmoire(e)},loading:k.armoires,emptyMessage:"Aucune armoire",folderColor:"text-ged-accent"});case"rayon":return(0,a.jsx)(Y,{items:P,selectedId:(null===(s=h.rayon)||void 0===s?void 0:s.id)||null,onSelect:e=>{x.selectRayon(e)},loading:k.rayons,emptyMessage:h.armoire?"Aucun rayon":"S\xe9lectionnez une armoire",folderColor:"text-ged-secondary"});case"classeur":return(0,a.jsx)(Y,{items:H,selectedId:(null===(l=h.classeur)||void 0===l?void 0:l.id)||null,onSelect:e=>{x.selectClasseur(e)},loading:k.classeurs,emptyMessage:h.rayon?"Aucun classeur":"S\xe9lectionnez un rayon",folderColor:"text-ged-primary"});case"dossier":return(0,a.jsx)(Y,{items:U,selectedId:(null===(n=h.dossier)||void 0===n?void 0:n.id)||null,onSelect:e=>{x.selectDossier(e)},loading:k.dossiers,emptyMessage:h.classeur?"Aucun dossier":"S\xe9lectionnez un classeur",folderColor:"text-purple-500"});case"intercalaire":return(0,a.jsx)(Y,{items:G,selectedId:(null===(r=h.intercalaire)||void 0===r?void 0:r.id)||null,onSelect:e=>{x.selectIntercalaire(e)},loading:k.intercalaires,emptyMessage:"Aucun intercalaire",folderColor:"text-pink-500"});case"documents":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto bg-white",children:k.documents?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===K.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted p-8",children:[(0,a.jsx)(I.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Aucun document"})]}):(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:K.map(e=>{var t;return(0,a.jsx)(J,{doc:e,isSelected:(null===(t=h.document)||void 0===t?void 0:t.id)===e.id,onSelect:ec},e.id)})})});default:return null}})()}),(0,a.jsx)(X,{selection:h,hasIntercalaires:el,armoires:z,documents:K}),_&&h.document&&(0,a.jsx)(Q,{document:h.document,onClose:()=>L(!1)})]})}return(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden bg-ged-surface-alt relative",children:[(0,a.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",children:(0,a.jsxs)("div",{className:"flex min-w-max h-full",children:[(0,a.jsx)(B,{title:"ARMOIRE",items:z,selectedId:(null===(e=h.armoire)||void 0===e?void 0:e.id)||null,onSelect:x.selectArmoire,loading:k.armoires,folderColor:"text-ged-accent"}),(0,a.jsx)(B,{title:"RAYON",items:P,selectedId:(null===(t=h.rayon)||void 0===t?void 0:t.id)||null,onSelect:x.selectRayon,loading:k.rayons,emptyMessage:h.armoire?"Aucun rayon":"S\xe9lectionnez une armoire",folderColor:"text-ged-secondary"}),(0,a.jsx)(B,{title:"CLASSEUR",items:H,selectedId:(null===(s=h.classeur)||void 0===s?void 0:s.id)||null,onSelect:x.selectClasseur,loading:k.classeurs,emptyMessage:h.rayon?"Aucun classeur":"S\xe9lectionnez un rayon",folderColor:"text-ged-primary"}),(0,a.jsx)(B,{title:"DOSSIER",items:U,selectedId:(null===(n=h.dossier)||void 0===n?void 0:n.id)||null,onSelect:x.selectDossier,loading:k.dossiers,emptyMessage:h.classeur?"Aucun dossier":"S\xe9lectionnez un classeur",folderColor:"text-purple-500"}),el&&(0,a.jsx)(B,{title:"INTERCALAIRE",items:G,selectedId:(null===(i=h.intercalaire)||void 0===i?void 0:i.id)||null,onSelect:x.selectIntercalaire,loading:k.intercalaires,emptyMessage:"S\xe9lectionnez un intercalaire",folderColor:"text-pink-500"}),(0,a.jsxs)("div",{className:"flex-1 bg-white flex flex-col min-w-[300px] flex-shrink-0",children:[(0,a.jsxs)("div",{className:"column-header",children:[(0,a.jsx)("span",{children:"DOCUMENTS"}),(0,a.jsx)("span",{className:"text-[10px] font-normal text-ged-text-muted",children:K.length})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:k.documents?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===K.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted p-8",children:[(0,a.jsx)(I.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:el&&!h.intercalaire?"S\xe9lectionnez un intercalaire":h.dossier||h.intercalaire?"Aucun document":"S\xe9lectionnez un dossier"})]}):(0,a.jsx)(ee,{documents:K,viewMode:O,selectedId:(null===(c=h.document)||void 0===c?void 0:c.id)||null,onSelect:ec})})]})]})}),_&&h.document&&(0,a.jsx)(en,{document:h.document,onClose:()=>L(!1)})]})}function Y(e){let{items:t,selectedId:s,onSelect:l,loading:n,emptyMessage:r,folderColor:i}=e;return n?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-white",children:(0,a.jsx)(f.Z,{className:"w-8 h-8 animate-spin text-ged-secondary"})}):0===t.length?(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center bg-white text-ged-text-muted p-8",children:[(0,a.jsx)(T.Z,{className:"w-16 h-16 mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-sm text-center",children:r||"Aucun \xe9l\xe9ment"})]}):(0,a.jsx)("div",{className:"flex-1 overflow-y-auto bg-white",children:(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:t.map(e=>(0,a.jsxs)("button",{onClick:()=>l(e),className:"w-full flex items-center gap-3 px-4 py-3 text-left transition-colors active:bg-ged-surface ".concat(s===e.id?"bg-ged-primary text-white":"hover:bg-ged-surface"),children:[(0,a.jsx)(T.Z,{className:"w-6 h-6 flex-shrink-0 ".concat(s===e.id?"text-white":i)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.name}),void 0!==e.children_count&&(0,a.jsxs)("p",{className:"text-xs ".concat(s===e.id?"text-white/70":"text-ged-text-muted"),children:[e.children_count," \xe9l\xe9ment(s)"]})]}),(0,a.jsx)(S.Z,{className:"w-5 h-5 flex-shrink-0 ".concat(s===e.id?"text-white/70":"text-ged-text-muted")})]},e.id))})})}function J(e){let{doc:t,isSelected:s,onSelect:l}=e,{actions:n,dispatch:i}=(0,y.q)(),c=n.isFavorite(t.id);return(0,a.jsxs)("div",{onClick:()=>l(t),className:"w-full flex items-center gap-3 px-4 py-3 text-left transition-colors active:bg-ged-surface cursor-pointer ".concat(s?"bg-ged-primary text-white":""),children:[U(t.extension),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium truncate text-sm flex-1",children:t.name}),c&&(0,a.jsx)(r.Z,{className:"w-4 h-4 text-amber-500 fill-amber-500 flex-shrink-0"})]}),(0,a.jsxs)("p",{className:"text-xs ".concat(s?"text-white/70":"text-ged-text-muted"),children:[".",t.extension," • ",el(t.size||0)]})]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),i({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:t.id,itemName:t.name}}})},className:"p-2 rounded-full ".concat(s?"text-white/70 hover:bg-white/20":"text-ged-text-muted hover:bg-ged-surface"),children:(0,a.jsx)(M.Z,{className:"w-5 h-5"})}),(0,a.jsx)(S.Z,{className:"w-5 h-5 flex-shrink-0 ".concat(s?"text-white/70":"text-ged-text-muted")})]})}function Q(e){let{document:t,onClose:s}=e,{state:n,dispatch:i,actions:c}=(0,y.q)(),d=(0,k.km)(t.id,n.activeUrl||void 0),o=(0,k.pC)(t.id,n.activeUrl||void 0),m=c.isFavorite(t.id),x=(()=>{var e;let s=(null===(e=t.extension)||void 0===e?void 0:e.toLowerCase())||"";return["jpg","jpeg","png","gif","webp","svg"].includes(s)?"image":"pdf"===s?"pdf":["txt","md","json","xml","csv","html","css","js","ts","py","sh"].includes(s)?"text":"none"})();return(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s]),(0,a.jsxs)("div",{className:"fixed inset-0 z-50 bg-black flex flex-col animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-ged-primary to-ged-secondary text-white",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 mr-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-medium truncate text-sm flex-1",children:t.name}),m&&(0,a.jsx)(r.Z,{className:"w-4 h-4 text-amber-400 fill-amber-400 flex-shrink-0"})]}),(0,a.jsxs)("p",{className:"text-xs text-white/70",children:[".",t.extension," • ",el(t.size||0)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{m?c.removeFavorite(t.id):c.addFavorite(t)},className:"p-2 rounded-full ".concat(m?"bg-amber-500":"bg-white/20"," active:bg-white/30"),children:(0,a.jsx)(r.Z,{className:"w-5 h-5 ".concat(m?"fill-white":"")})}),(0,a.jsx)("a",{href:d,download:!0,className:"p-2 rounded-full bg-white/20 active:bg-white/30",children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:s,className:"p-2 rounded-full bg-white/20 active:bg-white/30",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-h-0 overflow-auto bg-black",style:{WebkitOverflowScrolling:"touch"},children:["image"===x&&(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center p-4",children:(0,a.jsx)("img",{src:o,alt:t.name,className:"max-w-full max-h-full object-contain"})}),"pdf"===x&&(0,a.jsxs)("object",{data:"".concat(o,"#toolbar=1&navpanes=0&scrollbar=1&view=FitH"),type:"application/pdf",className:"w-full h-full min-h-[70vh]","aria-label":t.name,children:[(0,a.jsx)("iframe",{src:"".concat(o,"#toolbar=1&navpanes=0&scrollbar=1&view=FitH"),className:"w-full h-full min-h-[70vh] border-0",title:t.name,allowFullScreen:!0}),(0,a.jsxs)("div",{className:"p-4 text-center text-white",children:[(0,a.jsx)("p",{className:"mb-2",children:"Le PDF ne peut pas \xeatre affich\xe9 ici."}),(0,a.jsx)("a",{href:o,target:"_blank",rel:"noreferrer",className:"underline",children:"Ouvrir dans un nouvel onglet"})]})]}),"text"===x&&(0,a.jsx)("iframe",{src:o,className:"w-full h-full min-h-[70vh] bg-white border-0",title:t.name,allowFullScreen:!0}),"none"===x&&(0,a.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center text-white p-8",children:[G(t.extension),(0,a.jsx)("p",{className:"mt-4 text-lg font-medium",children:t.name}),(0,a.jsx)("p",{className:"text-white/70 mb-6",children:"Aper\xe7u non disponible"}),(0,a.jsx)("a",{href:d,download:!0,className:"px-6 py-3 bg-white text-ged-primary font-medium rounded-lg active:bg-gray-100",children:"T\xe9l\xe9charger"})]})]})]})}function X(e){let{selection:t,hasIntercalaires:s,armoires:l,documents:n}=e,{state:r}=(0,y.q)(),i=t.document?{type:"Doc",name:t.document.name}:t.intercalaire?{type:"Int",name:t.intercalaire.name}:t.dossier?{type:"Dos",name:t.dossier.name}:t.classeur?{type:"Cls",name:t.classeur.name}:t.rayon?{type:"Ray",name:t.rayon.name}:t.armoire?{type:"Arm",name:t.armoire.name}:null;return(0,a.jsxs)("div",{className:"flex-shrink-0 bg-white border-t border-ged-border flex items-center px-3 gap-2 text-xs",style:{minHeight:"44px",paddingBottom:"max(8px, env(safe-area-inset-bottom))",paddingTop:"8px"},children:[(0,a.jsxs)("svg",{className:"w-4 h-4 flex-shrink-0 ".concat(r.apiConnected?"text-emerald-500":"text-red-500"),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M5 12.55a11 11 0 0 1 14.08 0"}),(0,a.jsx)("path",{d:"M1.42 9a16 16 0 0 1 21.16 0"}),(0,a.jsx)("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),(0,a.jsx)("circle",{cx:"12",cy:"20",r:"1",fill:"currentColor"})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-ged-border flex-shrink-0"}),i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"px-1.5 py-0.5 bg-ged-surface-alt rounded text-[10px] uppercase text-ged-text-muted font-medium flex-shrink-0",children:i.type}),(0,a.jsx)("span",{className:"text-ged-primary font-medium truncate flex-1 min-w-0",children:i.name})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2 text-ged-text-muted flex-1",children:[(0,a.jsxs)("span",{children:[l.length," armoires"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:[n.length," docs"]})]})]})}function ee(e){let{documents:t,viewMode:s,selectedId:l,onSelect:n}=e;switch(s){case"grid":return(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 p-3",children:t.map(e=>(0,a.jsx)(et,{doc:e,isSelected:l===e.id,onSelect:n},e.id))});case"details":return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-ged-surface-alt border-b border-ged-border sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-ged-text-muted",children:"Nom"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-ged-text-muted w-24",children:"Type"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-ged-text-muted w-24",children:"Taille"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-ged-text-muted w-28",children:"Modifi\xe9"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-ged-text-muted w-32",children:"\xc9tiquettes"}),(0,a.jsx)("th",{className:"w-24"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-ged-border/50",children:t.map(e=>(0,a.jsx)(es,{doc:e,isSelected:l===e.id,onSelect:n},e.id))})]})});default:return(0,a.jsx)("div",{className:"divide-y divide-ged-border/50",children:t.map(e=>(0,a.jsx)(ea,{doc:e,isSelected:l===e.id,onSelect:n},e.id))})}}function et(e){let{doc:t,isSelected:s,onSelect:l}=e,{state:i,dispatch:c,actions:d}=(0,y.q)(),o=d.isFavorite(t.id),m=t.tags&&0!==t.tags.length?t.tags.slice(0,3).map(e=>{let t=i.availableTags.find(t=>t.name===e);return{name:e,color:(null==t?void 0:t.color)||"#3b82f6"}}):[];return(0,a.jsxs)("div",{onClick:()=>{l?l(t):d.selectDocument(t)},className:"group relative flex flex-col items-center p-3 rounded-lg border-2 transition-all cursor-pointer hover:shadow-md ".concat(s?"border-ged-primary bg-ged-primary/5":"border-transparent hover:border-ged-border hover:bg-ged-surface"),children:[(0,a.jsx)("div",{className:"w-16 h-16 flex items-center justify-center mb-2",children:G(t.extension)}),(0,a.jsx)("p",{className:"text-xs font-medium text-center truncate w-full",title:t.name,children:t.name}),(0,a.jsx)("p",{className:"text-[10px] text-ged-text-muted",children:el(t.size||0)}),m.length>0&&(0,a.jsx)("div",{className:"flex items-center gap-0.5 mt-1",children:m.map(e=>(0,a.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color},title:e.name},e.name))}),(0,a.jsxs)("div",{className:"absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"rename",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded bg-white shadow hover:bg-ged-surface",title:"Renommer",children:(0,a.jsx)(z.Z,{className:"w-3 h-3 text-ged-secondary"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o?d.removeFavorite(t.id):d.addFavorite(t)},className:"p-1 rounded bg-white shadow hover:bg-ged-surface ".concat(o?"text-amber-500":"text-ged-text-muted hover:text-amber-500"),title:o?"Retirer des favoris":"Ajouter aux favoris",children:(0,a.jsx)(r.Z,{className:"w-3 h-3 ".concat(o?"fill-current":"")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d.selectDocument(t),c({type:"SHOW_MODAL",payload:{type:"tags"}})},className:"p-1 rounded bg-white shadow hover:bg-ged-surface",title:"\xc9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-3 h-3 text-ged-accent"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:t.id,itemName:t.name}}})},className:"p-1 rounded bg-white shadow hover:bg-ged-surface",title:"D\xe9placer",children:(0,a.jsx)(M.Z,{className:"w-3 h-3 text-blue-500"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation();let s=(0,k.km)(t.id,i.activeUrl||void 0);window.open(s,"_blank")},className:"p-1 rounded bg-white shadow hover:bg-ged-surface",title:"T\xe9l\xe9charger",children:(0,a.jsx)(h.Z,{className:"w-3 h-3 text-ged-secondary"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"delete",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded bg-white shadow hover:bg-red-50",title:"Supprimer",children:(0,a.jsx)(p.Z,{className:"w-3 h-3 text-red-500"})})]})]})}function es(e){let{doc:t,isSelected:s,onSelect:l}=e,{state:i,dispatch:c,actions:d}=(0,y.q)(),o=d.isFavorite(t.id),m=t.tags&&0!==t.tags.length?t.tags.slice(0,4).map(e=>{let t=i.availableTags.find(t=>t.name===e);return{name:e,color:(null==t?void 0:t.color)||"#3b82f6"}}):[];return(0,a.jsxs)("tr",{onClick:()=>{l?l(t):d.selectDocument(t)},className:"group cursor-pointer transition-colors ".concat(s?"bg-ged-primary text-white":"hover:bg-ged-surface"),children:[(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[U(t.extension),(0,a.jsx)("span",{className:"truncate font-medium",title:t.name,children:t.name})]})}),(0,a.jsx)("td",{className:"px-3 py-2 uppercase text-xs ".concat(s?"text-white/70":"text-ged-text-muted"),children:t.extension}),(0,a.jsx)("td",{className:"px-3 py-2 ".concat(s?"text-white/70":"text-ged-text-muted"),children:el(t.size||0)}),(0,a.jsx)("td",{className:"px-3 py-2 ".concat(s?"text-white/70":"text-ged-text-muted"),children:(e=>{try{return new Date(e).toLocaleDateString("fr-FR")}catch(e){return"-"}})(t.modified_at)}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("div",{className:"flex items-center gap-1",children:m.map(e=>(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color},title:e.name},e.name))})}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"rename",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-ged-surface-alt"),title:"Renommer",children:(0,a.jsx)(z.Z,{className:"w-4 h-4 ".concat(s?"text-white/70":"text-ged-secondary")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o?d.removeFavorite(t.id):d.addFavorite(t)},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-ged-surface-alt"," ").concat(o?"text-amber-500":s?"text-white/70":"text-ged-secondary hover:text-amber-500"),title:o?"Retirer des favoris":"Ajouter aux favoris",children:(0,a.jsx)(r.Z,{className:"w-4 h-4 ".concat(o?"fill-current":"")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d.selectDocument(t),c({type:"SHOW_MODAL",payload:{type:"tags"}})},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-ged-surface-alt"),title:"\xc9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-4 h-4 ".concat(s?"text-white/70":"text-ged-accent")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:t.id,itemName:t.name}}})},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-ged-surface-alt"),title:"D\xe9placer",children:(0,a.jsx)(M.Z,{className:"w-4 h-4 ".concat(s?"text-white/70":"text-blue-500")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation();let s=(0,k.km)(t.id,i.activeUrl||void 0);window.open(s,"_blank")},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-ged-surface-alt"),title:"T\xe9l\xe9charger",children:(0,a.jsx)(h.Z,{className:"w-4 h-4 ".concat(s?"text-white/70":"text-ged-secondary")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"delete",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded ".concat(s?"hover:bg-white/20":"hover:bg-red-50"),title:"Supprimer",children:(0,a.jsx)(p.Z,{className:"w-4 h-4 ".concat(s?"text-white/70":"text-red-500")})})]})})]})}function ea(e){let{doc:t,isSelected:s,onSelect:l}=e,{state:i,dispatch:c,actions:d}=(0,y.q)(),o=d.isFavorite(t.id),m=t.tags&&0!==t.tags.length?t.tags.slice(0,3).map(e=>{let t=i.availableTags.find(t=>t.name===e);return{name:e,color:(null==t?void 0:t.color)||"#3b82f6"}}):[],x=t.tags&&t.tags.length>3;return(0,a.jsxs)("div",{onClick:()=>{l?l(t):d.selectDocument(t)},className:"list-item group ".concat(s?"selected":""),children:[U(t.extension),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"truncate text-sm font-medium",children:t.name}),m.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[m.map((e,t)=>(0,a.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color},title:e.name},e.name)),x&&(0,a.jsxs)("span",{className:"text-[10px] ".concat(s?"text-white/70":"text-ged-text-muted"),children:["+",t.tags.length-3]})]})]}),(0,a.jsxs)("div",{className:"text-xs ".concat(s?"text-white/70":"text-ged-text-muted"),children:[".",t.extension," • ",el(t.size||0)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"rename",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded ".concat(s?"text-white/70 hover:text-white":"text-ged-text-muted hover:text-ged-secondary hover:bg-ged-surface-alt"),title:"Renommer",children:(0,a.jsx)(z.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o?d.removeFavorite(t.id):d.addFavorite(t)},className:"p-1 rounded ".concat(o?"text-amber-500 hover:text-amber-600":s?"text-white/70 hover:text-amber-400":"text-ged-text-muted hover:text-amber-500 hover:bg-amber-50"),title:o?"Retirer des favoris":"Ajouter aux favoris",children:(0,a.jsx)(r.Z,{className:"w-4 h-4 ".concat(o?"fill-current":"")})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d.selectDocument(t),c({type:"SHOW_MODAL",payload:{type:"tags"}})},className:"p-1 rounded ".concat(s?"text-white/70 hover:text-white":"text-ged-text-muted hover:text-ged-accent hover:bg-ged-surface-alt"),title:"\xc9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"move",data:{itemId:t.id,itemName:t.name}}})},className:"p-1 rounded ".concat(s?"text-white/70 hover:text-white":"text-ged-text-muted hover:text-blue-500 hover:bg-blue-50"),title:"D\xe9placer",children:(0,a.jsx)(M.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation();let s=(0,k.km)(t.id,i.activeUrl||void 0);window.open(s,"_blank")},className:"p-1 rounded ".concat(s?"text-white/70 hover:text-white":"text-ged-text-muted hover:text-ged-secondary hover:bg-ged-surface-alt"),title:"T\xe9l\xe9charger",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c({type:"SHOW_MODAL",payload:{type:"delete",data:{itemId:t.id,itemName:t.name,level:"document"}}})},className:"p-1 rounded ".concat(s?"text-white/70 hover:text-white":"text-ged-text-muted hover:text-red-500 hover:bg-red-50"),title:"Supprimer",children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]})]})}function el(e){return e<1024?"".concat(e," o"):e<1048576?"".concat((e/1024).toFixed(1)," Ko"):"".concat((e/1048576).toFixed(1)," Mo")}function en(e){var t;let{document:s,onClose:r}=e,{state:i,dispatch:c}=(0,y.q)(),d=(0,k.km)(s.id,i.activeUrl||void 0),o=(0,k.pC)(s.id,i.activeUrl||void 0),m=(e=>{if(!e)return"none";let t=e.toLowerCase();return["jpg","jpeg","png","gif","webp","svg","bmp"].includes(t)?"image":"pdf"===t?"pdf":["txt","md","json","xml","csv","log","html","css","js","ts","py","sh"].includes(t)?"text":["doc","docx","xls","xlsx","ppt","pptx"].includes(t)?"office":"none"})(s.extension),x=()=>{window.open(d,"_blank")},u=s.tags&&0!==s.tags.length?s.tags.map(e=>{let t=i.availableTags.find(t=>t.name===e);return{name:e,color:(null==t?void 0:t.color)||"#3b82f6"}}):[];return l.useEffect(()=>{let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]),(0,a.jsxs)("div",{className:"absolute inset-0 z-50 flex",children:[(0,a.jsx)("div",{className:"w-1/2 bg-black/30 backdrop-blur-sm cursor-pointer",onClick:r}),(0,a.jsxs)("div",{className:"w-1/2 bg-white flex flex-col shadow-2xl animate-slide-in-right",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ged-border bg-gradient-to-r from-ged-primary to-ged-secondary",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:er(s.extension)}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-sm text-white truncate",title:s.name,children:s.name}),(0,a.jsxs)("p",{className:"text-xs text-white/70",children:[null===(t=s.extension)||void 0===t?void 0:t.toUpperCase()," • ",el(s.size||0)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>{c({type:"SHOW_MODAL",payload:{type:"rename",data:{itemId:s.id,itemName:s.name,level:"document"}}})},className:"p-2 rounded-md text-white/70 hover:text-white hover:bg-white/10 transition-colors",title:"Renommer",children:(0,a.jsx)(z.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>{c({type:"SHOW_MODAL",payload:{type:"tags"}})},className:"p-2 rounded-md text-white/70 hover:text-white hover:bg-white/10 transition-colors",title:"\xc9tiquettes",children:(0,a.jsx)(n.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>{window.open(o,"_blank")},className:"p-2 rounded-md text-white/70 hover:text-white hover:bg-white/10 transition-colors",title:"Ouvrir dans un nouvel onglet",children:(0,a.jsx)(P.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:x,className:"p-2 rounded-md text-white/70 hover:text-white hover:bg-white/10 transition-colors",title:"T\xe9l\xe9charger",children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"w-px h-6 bg-white/20 mx-1"}),(0,a.jsx)("button",{onClick:r,className:"p-2 rounded-md text-white/70 hover:text-white hover:bg-white/10 transition-colors",title:"Fermer (\xc9chap)",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden bg-ged-surface-alt",children:["image"===m&&(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center p-4",children:(0,a.jsx)("img",{src:o,alt:s.name,className:"max-w-full max-h-full object-contain rounded-lg shadow-lg"})}),"pdf"===m&&(0,a.jsx)("object",{data:o,type:"application/pdf",className:"w-full h-full",children:(0,a.jsx)("iframe",{src:"".concat(o,"#toolbar=1&navpanes=0&scrollbar=1"),className:"w-full h-full border-0",title:s.name})}),"text"===m&&(0,a.jsx)("iframe",{src:o,className:"w-full h-full bg-white border-0",title:s.name}),"office"===m&&(0,a.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"w-24 h-24 mb-4 flex items-center justify-center bg-white rounded-xl shadow-lg",children:G(s.extension)}),(0,a.jsx)("h4",{className:"font-medium text-ged-text mb-2",children:"Document Office"}),(0,a.jsxs)("p",{className:"text-sm text-ged-text-muted mb-4 text-center",children:["Les documents Office ne peuvent pas \xeatre pr\xe9visualis\xe9s directement.",(0,a.jsx)("br",{}),"T\xe9l\xe9chargez-le pour l'ouvrir."]}),(0,a.jsxs)("button",{onClick:x,className:"btn btn-primary",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"T\xe9l\xe9charger"]})]}),"none"===m&&(0,a.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"w-24 h-24 mb-4 flex items-center justify-center bg-white rounded-xl shadow-lg",children:G(s.extension)}),(0,a.jsx)("h4",{className:"font-medium text-ged-text mb-2",children:"Aper\xe7u non disponible"}),(0,a.jsx)("p",{className:"text-sm text-ged-text-muted mb-4 text-center",children:"Ce type de fichier ne peut pas \xeatre pr\xe9visualis\xe9."}),(0,a.jsxs)("button",{onClick:x,className:"btn btn-primary",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"T\xe9l\xe9charger le fichier"]})]})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-t border-ged-border bg-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-3 text-xs text-ged-text-muted",children:(0,a.jsxs)("span",{children:["Modifi\xe9 le ",(e=>{try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return"-"}})(s.modified_at)]})}),u.length>0&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:u.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium text-white",style:{backgroundColor:e.color},children:e.name},e.name))})]})})]})]})}let er=e=>{if(!e)return(0,a.jsx)(E.Z,{className:"w-5 h-5 text-white"});let t=e.toLowerCase();return({pdf:(0,a.jsx)(I.Z,{className:"w-5 h-5 text-white"}),jpg:(0,a.jsx)(O.Z,{className:"w-5 h-5 text-white"}),jpeg:(0,a.jsx)(O.Z,{className:"w-5 h-5 text-white"}),png:(0,a.jsx)(O.Z,{className:"w-5 h-5 text-white"}),gif:(0,a.jsx)(O.Z,{className:"w-5 h-5 text-white"}),webp:(0,a.jsx)(O.Z,{className:"w-5 h-5 text-white"}),doc:(0,a.jsx)(_.Z,{className:"w-5 h-5 text-white"}),docx:(0,a.jsx)(_.Z,{className:"w-5 h-5 text-white"}),xls:(0,a.jsx)(L.Z,{className:"w-5 h-5 text-white"}),xlsx:(0,a.jsx)(L.Z,{className:"w-5 h-5 text-white"}),zip:(0,a.jsx)(F.Z,{className:"w-5 h-5 text-white"}),rar:(0,a.jsx)(F.Z,{className:"w-5 h-5 text-white"})})[t]||(0,a.jsx)(E.Z,{className:"w-5 h-5 text-white"})};var ei=s(2926),ec=s(5395),ed=s(91);function eo(e){try{let t=new Date(e);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return e}}function em(){let{state:e}=(0,y.q)(),t=(0,y.f)(),{selection:s,armoires:n,documents:r,apiConnected:i}=e,c=s.document?{type:"Document",name:s.document.name,size:function(e){if(0===e)return"0 o";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(1))," ").concat(["o","Ko","Mo","Go"][t])}(s.document.size||0),date:eo(s.document.modified_at)}:s.intercalaire?{type:"Intercalaire",name:s.intercalaire.name,count:s.intercalaire.children_count||0,unit:"doc",date:eo(s.intercalaire.modified_at)}:s.dossier?{type:"Dossier",name:s.dossier.name,count:s.dossier.children_count||0,unit:"\xe9l\xe9ment",date:eo(s.dossier.modified_at)}:s.classeur?{type:"Classeur",name:s.classeur.name,count:s.classeur.children_count||0,unit:"dossier",date:eo(s.classeur.modified_at)}:s.rayon?{type:"Rayon",name:s.rayon.name,count:s.rayon.children_count||0,unit:"classeur",date:eo(s.rayon.modified_at)}:s.armoire?{type:"Armoire",name:s.armoire.name,count:s.armoire.children_count||0,unit:"rayon",date:eo(s.armoire.modified_at)}:null;return(0,a.jsxs)("footer",{className:"hidden md:flex h-8 bg-white border-t border-ged-border text-xs items-center px-3 gap-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-1.5",title:i?"Connect\xe9: ".concat((0,k.qt)()):"Non connect\xe9",children:i?(0,a.jsx)(ei.Z,{className:"w-3.5 h-3.5 text-emerald-500"}):(0,a.jsx)(ec.Z,{className:"w-3.5 h-3.5 text-red-500"})}),(0,a.jsx)("div",{className:"w-px h-4 bg-ged-border"}),(0,a.jsx)("div",{className:"flex items-center gap-1 min-w-0 flex-shrink",children:t.length>0?(0,a.jsxs)(a.Fragment,{children:[t.length>2&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-ged-text-muted",children:"..."}),(0,a.jsx)(S.Z,{className:"w-3 h-3 text-ged-border flex-shrink-0"})]}),t.slice(-2).map((e,t,s)=>(0,a.jsxs)(l.Fragment,{children:[t>0&&(0,a.jsx)(S.Z,{className:"w-3 h-3 text-ged-border flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate max-w-[100px] ".concat(t===s.length-1?"text-ged-primary font-medium":"text-ged-text-muted"),children:e.name})]},e.id))]}):(0,a.jsx)("span",{className:"text-ged-text-muted",children:"Accueil"})}),(0,a.jsx)("div",{className:"flex-1"}),c?(0,a.jsxs)("div",{className:"flex items-center gap-3 text-ged-text",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"px-1.5 py-0.5 bg-ged-surface-alt rounded text-[10px] uppercase tracking-wide text-ged-text-muted",children:c.type}),(0,a.jsx)("span",{className:"text-ged-primary font-medium truncate max-w-[150px]",children:c.name})]}),"size"in c?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-ged-text-muted",children:[(0,a.jsx)(ed.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:c.size})]}):"count"in c?(0,a.jsxs)("span",{className:"text-ged-text-muted",children:[c.count," ",c.unit,c.count>1?"s":""]}):null,(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-1 text-ged-text-muted",children:[(0,a.jsx)(A.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:c.date})]})]}):(0,a.jsxs)("div",{className:"flex items-center gap-3 text-ged-text-muted",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(T.Z,{className:"w-3.5 h-3.5 text-ged-accent"}),(0,a.jsx)("span",{children:n.length})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(I.Z,{className:"w-3.5 h-3.5 text-ged-secondary"}),(0,a.jsx)("span",{children:r.length})]})]})]})}var ex=s(6865),eu=s(3245),eh=s(401);function ep(){let{state:e,dispatch:t}=(0,y.q)(),{modal:s}=e;if(!s.type)return null;let l=()=>{t({type:"HIDE_MODAL"})};return(0,a.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&l()},children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:["create"===s.type&&(0,a.jsx)(eg,{onClose:l,data:s.data}),"rename"===s.type&&(0,a.jsx)(ef,{onClose:l,data:s.data}),"upload"===s.type&&(0,a.jsx)(ej,{onClose:l}),"delete"===s.type&&(0,a.jsx)(eb,{onClose:l,data:s.data}),"move"===s.type&&(0,a.jsx)(eN,{onClose:l,data:s.data}),"details"===s.type&&(0,a.jsx)(ev,{onClose:l}),"tags"===s.type&&(0,a.jsx)(ew,{onClose:l}),"manageTags"===s.type&&(0,a.jsx)(ey,{onClose:l})]})})}function eg(e){let{onClose:t,data:s}=e,{state:n,actions:r}=(0,y.q)(),[i,c]=(0,l.useState)(""),[d,o]=(0,l.useState)(!1),[x,u]=(0,l.useState)(null),h=(null==s?void 0:s.itemType)||"dossier",p={armoire:"armoire",rayon:"rayon",classeur:"classeur",dossier:"dossier",intercalaire:"intercalaire"},g=()=>{var e,t,s,a;switch(h){case"rayon":return(null===(e=n.selection.armoire)||void 0===e?void 0:e.id)||null;case"classeur":return(null===(t=n.selection.rayon)||void 0===t?void 0:t.id)||null;case"dossier":return(null===(s=n.selection.classeur)||void 0===s?void 0:s.id)||null;case"intercalaire":return(null===(a=n.selection.dossier)||void 0===a?void 0:a.id)||null;default:return null}},j=async e=>{if(e.preventDefault(),i.trim()){o(!0),u(null);try{await r.createItem(g(),i.trim(),h)}catch(e){u(e instanceof Error?e.message:"Erreur"),o(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-secondary/10 rounded-lg",children:(0,a.jsx)(m.Z,{className:"w-5 h-5 text-ged-secondary"})}),(0,a.jsxs)("h2",{className:"font-display font-semibold text-lg",children:["Cr\xe9er un(e) ",p[h]]})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("form",{onSubmit:j,className:"p-4 space-y-4",children:[x&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:x})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ged-text mb-1.5",children:"Nom"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Nom de l'".concat(p[h]),className:"input",autoFocus:!0,disabled:d})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"btn btn-secondary",disabled:d,children:"Annuler"}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:!i.trim()||d,children:d?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):"Cr\xe9er"})]})]})]})}function ej(e){let{onClose:t}=e,{state:s,actions:n}=(0,y.q)(),[r,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)([]),[o,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),p=(e,t)=>{d(s=>s.map((s,a)=>a===e?{...s,customName:t}:s))},g=e=>{let t=e.match(/\.([^/.]+)$/);return t?t[1]:""},j=s.intercalaires&&s.intercalaires.length>0,N=s.selection.intercalaire||(j?null:s.selection.dossier),v=!!N,w=async()=>{if(N&&0!==c.length){m(!0),h(null);try{let e=c.map(e=>{let{file:t,customName:s}=e,a=g(t.name),l="".concat(s,".").concat(a);return l!==t.name?new File([t],l,{type:t.type}):t});await n.uploadFiles(N.id,e),t()}catch(e){h(e instanceof Error?e.message:"Erreur"),m(!1)}}},k=e=>{d(t=>t.filter((t,s)=>s!==e))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-accent/10 rounded-lg",children:(0,a.jsx)(u.Z,{className:"w-5 h-5 text-ged-accent"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"Importer des documents"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",disabled:o,children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[!v&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg text-amber-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:j?"S\xe9lectionnez un intercalaire pour importer":"S\xe9lectionnez un dossier pour importer"})]}),v&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 text-sm",children:[(0,a.jsx)(eu.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Import dans : ",(0,a.jsx)("strong",{children:null==N?void 0:N.name})]})]}),x&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:x})]}),(0,a.jsx)("div",{className:"drop-zone ".concat(r?"active":""," ").concat(!v||o?"opacity-50 pointer-events-none":""),onDragOver:e=>{e.preventDefault(),i(!0)},onDragLeave:()=>i(!1),onDrop:e=>{e.preventDefault(),i(!1);let t=Array.from(e.dataTransfer.files).map(e=>({file:e,customName:e.name.replace(/\.[^/.]+$/,"")}));d(e=>[...e,...t])},children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,a.jsx)(u.Z,{className:"w-12 h-12 text-ged-text-muted"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Glissez-d\xe9posez vos fichiers"}),(0,a.jsxs)("p",{className:"text-sm text-ged-text-muted mt-1",children:["ou ",(0,a.jsxs)("label",{className:"text-ged-secondary cursor-pointer hover:underline",children:["parcourez",(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>{if(e.target.files){let t=Array.from(e.target.files).map(e=>({file:e,customName:e.name.replace(/\.[^/.]+$/,"")}));d(e=>[...e,...t])}},disabled:!v||o})]})]})]})]})}),c.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:[c.length," fichier(s) - Modifiez les noms si n\xe9cessaire"]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:c.map((e,t)=>{let s=g(e.file.name);return(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-ged-surface rounded-lg",children:[(0,a.jsx)(I.Z,{className:"w-4 h-4 text-ged-text-muted flex-shrink-0"}),(0,a.jsx)("input",{type:"text",value:e.customName,onChange:e=>p(t,e.target.value),className:"flex-1 px-2 py-1 text-sm border border-ged-border rounded focus:outline-none focus:ring-2 focus:ring-ged-secondary focus:border-transparent",disabled:o}),(0,a.jsxs)("span",{className:"text-xs text-ged-text-muted flex-shrink-0",children:[".",s]}),(0,a.jsx)("button",{onClick:()=>k(t),className:"text-ged-text-muted hover:text-red-500 flex-shrink-0",disabled:o,children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]},t)})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",disabled:o,children:"Annuler"}),(0,a.jsx)("button",{onClick:w,className:"btn btn-primary",disabled:0===c.length||!v||o,children:o?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):"Importer"})]})]})]})}function ef(e){let{onClose:t,data:s}=e,{actions:n}=(0,y.q)(),[r,i]=(0,l.useState)(""),[c,d]=(0,l.useState)(!1),[o,m]=(0,l.useState)(null),x=(null==s?void 0:s.itemName)||"",u=(null==s?void 0:s.itemId)||"",h=(null==s?void 0:s.level)||"document",p="document"===h,g=e=>p?e.replace(/\.[^/.]+$/,""):e,j=e=>{let t=e.match(/\.([^/.]+)$/);return t?t[1]:""};(0,l.useEffect)(()=>{i(g(x))},[x]);let N=async e=>{if(e.preventDefault(),r.trim()&&u){d(!0),m(null);try{let e=p?"".concat(r.trim(),".").concat(j(x)):r.trim();await n.renameItem(u,e,h),t()}catch(e){m(e instanceof Error?e.message:"Erreur lors du renommage"),d(!1)}}},v=p?j(x):null;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-secondary/10 rounded-lg",children:(0,a.jsx)(I.Z,{className:"w-5 h-5 text-ged-secondary"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"Renommer"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",disabled:c,children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("form",{onSubmit:N,className:"p-4 space-y-4",children:[o&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:o})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom actuel"}),(0,a.jsx)("p",{className:"text-sm text-ged-text-muted bg-ged-surface px-3 py-2 rounded-lg",children:x})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newName",className:"block text-sm font-medium mb-2",children:"Nouveau nom"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{id:"newName",type:"text",value:r,onChange:e=>i(e.target.value),className:"input flex-1",placeholder:"Entrez le nouveau nom",autoFocus:!0,disabled:c}),v&&(0,a.jsxs)("span",{className:"text-sm text-ged-text-muted",children:[".",v]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"btn btn-secondary",disabled:c,children:"Annuler"}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:!r.trim()||r.trim()===g(x)||c,children:c?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):"Renommer"})]})]})]})}function eb(e){let{onClose:t,data:s}=e,{actions:n}=(0,y.q)(),[r,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)(null),o=async()=>{if((null==s?void 0:s.itemId)&&(null==s?void 0:s.level)){i(!0),d(null);try{await n.deleteItem(s.itemId,s.level)}catch(e){d(e instanceof Error?e.message:"Erreur"),i(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)(ex.Z,{className:"w-5 h-5 text-red-600"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"Confirmer la suppression"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",disabled:r,children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[c&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:c})]}),(0,a.jsxs)("p",{children:["Supprimer ",(0,a.jsx)("strong",{children:null==s?void 0:s.itemName})," ? ",(null==s?void 0:s.level)!=="document"&&"Tous les \xe9l\xe9ments contenus seront supprim\xe9s.",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-red-600 text-sm",children:"Action irr\xe9versible."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",disabled:r,children:"Annuler"}),(0,a.jsx)("button",{onClick:o,className:"btn bg-red-600 text-white hover:bg-red-700",disabled:r,children:r?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):"Supprimer"})]})]})]})}function eN(e){let{onClose:t,data:s}=e,{actions:n,state:r}=(0,y.q)(),[i,c]=(0,l.useState)(!1),[d,o]=(0,l.useState)(null),[x,u]=(0,l.useState)(null),[h,p]=(0,l.useState)([]),[g,N]=(0,l.useState)(!0),[v,w]=(0,l.useState)("");(0,l.useEffect)(()=>{!async function(){try{let e=await n.getTree();p(e)}catch(e){console.error("Erreur chargement arbre",e)}finally{N(!1)}}()},[n]);let k=(0,l.useMemo)(()=>{if(!v.trim())return h;let e=t=>t.reduce((t,s)=>{let a=s.name.toLowerCase().includes(v.toLowerCase()),l=s.children?e(s.children):[];return(a||l.length>0)&&t.push({...s,children:l}),t},[]);return e(h)},[h,v]),Z=async()=>{if((null==s?void 0:s.itemId)&&x){c(!0),o(null);try{await n.moveItem(s.itemId,x),t()}catch(e){o(e instanceof Error?e.message:"Erreur lors du d\xe9placement"),c(!1)}}},C=e=>{let{node:t,level:l=0}=e,n=(null==s?void 0:s.itemId)!==t.id&&["armoire","rayon","classeur","dossier","intercalaire"].includes(t.type);return"document"===t.type?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded cursor-pointer ".concat(x===t.id?"bg-ged-primary text-white":"hover:bg-ged-surface"),style:{paddingLeft:"".concat(16*l+8,"px")},onClick:()=>n&&u(t.id),children:[x===t.id&&(0,a.jsx)(eh.Z,{className:"w-4 h-4"}),(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-current opacity-20"})," ",(0,a.jsx)("span",{className:"text-sm ".concat(n?"":"opacity-50"),children:t.name})]}),t.children&&t.children.map(e=>(0,a.jsx)(C,{node:e,level:l+1},e.id))]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("h2",{className:"font-display font-semibold text-lg",children:["D\xe9placer ",null==s?void 0:s.itemName]})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",disabled:i,children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col h-[500px]",children:[d&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm mb-4",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:d})]}),(0,a.jsx)("p",{className:"mb-2 text-sm font-medium",children:"S\xe9lectionnez la destination :"}),(0,a.jsxs)("div",{className:"relative mb-3",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),placeholder:"Rechercher un dossier...",className:"w-full pl-9 pr-3 py-2 border border-ged-border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-ged-primary/20 focus:border-ged-primary"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto border border-ged-border rounded-lg p-2",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===k.length?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-ged-text-muted",children:(0,a.jsx)("p",{className:"text-sm",children:"Aucun dossier trouv\xe9"})}):k.map(e=>(0,a.jsx)(C,{node:e},e.id))}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",disabled:i,children:"Annuler"}),(0,a.jsx)("button",{onClick:Z,className:"btn btn-primary",disabled:!x||i,children:i?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):"D\xe9placer"})]})]})]})}function ev(e){let{onClose:t}=e,{state:s,dispatch:l}=(0,y.q)(),n=s.selection.document;return n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-secondary/10 rounded-lg",children:(0,a.jsx)(eu.Z,{className:"w-5 h-5 text-ged-secondary"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"D\xe9tails"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-ged-text-muted mb-1",children:"Nom"}),(0,a.jsx)("p",{className:"font-medium",children:n.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-ged-text-muted mb-1",children:"Extension"}),(0,a.jsxs)("p",{className:"font-medium",children:[".",n.extension]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-ged-text-muted mb-1",children:"Taille"}),(0,a.jsxs)("p",{className:"font-medium",children:[((n.size||0)/1024).toFixed(1)," Ko"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-ged-text-muted mb-1",children:"Modifi\xe9"}),(0,a.jsx)("p",{className:"font-medium",children:(e=>{try{return new Date(e).toLocaleDateString("fr-FR")}catch(t){return e}})(n.modified_at)})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("p",{className:"text-ged-text-muted mb-1",children:"Chemin"}),(0,a.jsx)("p",{className:"font-mono text-xs bg-ged-surface-alt p-2 rounded",children:n.path})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("p",{className:"text-ged-text-muted",children:"\xc9tiquettes"}),(0,a.jsx)("button",{onClick:()=>l({type:"SHOW_MODAL",payload:{type:"tags"}}),className:"text-xs text-ged-secondary hover:underline",children:"Modifier"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:s.selectedItemTags.length>0?s.selectedItemTags.map(e=>{let t=s.availableTags.find(t=>t.name===e);return(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs text-white",style:{backgroundColor:(null==t?void 0:t.color)||"#3b82f6"},children:e},e)}):(0,a.jsx)("span",{className:"text-ged-text-muted text-xs",children:"Aucune"})})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-2",children:(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",children:"Fermer"})})]})]}):null}function ew(e){let{onClose:t}=e,{state:s,actions:r,dispatch:i}=(0,y.q)(),[c,d]=(0,l.useState)(null),[o,m]=(0,l.useState)(!0),[x,u]=(0,l.useState)([]),h=s.selection.document;if((0,l.useEffect)(()=>{h&&(h.tags&&h.tags.length>0?(u(h.tags),m(!1)):r.loadItemTags(h.id).then(()=>{u(s.selectedItemTags),m(!1)}))},[h]),(0,l.useEffect)(()=>{u(s.selectedItemTags)},[s.selectedItemTags]),!h)return null;let p=async e=>{d(e);try{x.includes(e)?(await r.removeTagFromItem(h.id,e),u(t=>t.filter(t=>t!==e))):(await r.addTagToItem(h.id,e),u(t=>[...t,e]))}finally{d(null)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-accent/10 rounded-lg",children:(0,a.jsx)(n.Z,{className:"w-5 h-5 text-ged-accent"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"\xc9tiquettes"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("p",{className:"text-sm text-ged-text-muted truncate",children:["Document : ",(0,a.jsx)("span",{className:"font-medium text-ged-text",children:h.name})]}),o?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 animate-spin text-ged-secondary"})}):0===s.availableTags.length?(0,a.jsxs)("div",{className:"text-center py-8 text-ged-text-muted",children:[(0,a.jsx)(n.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),(0,a.jsx)("p",{children:"Aucune \xe9tiquette disponible"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:'Cr\xe9ez des \xe9tiquettes depuis le menu "G\xe9rer les \xe9tiquettes"'})]}):(0,a.jsx)("div",{className:"space-y-2",children:s.availableTags.map(e=>{let t=x.includes(e.name),s=c===e.name;return(0,a.jsxs)("button",{onClick:()=>p(e.name),disabled:s,className:"w-full flex items-center gap-3 p-3 rounded-lg border transition-colors ".concat(t?"border-ged-secondary bg-ged-secondary/5":"border-ged-border hover:border-ged-secondary/50"),children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"flex-1 text-left font-medium",children:e.name}),s?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):t?(0,a.jsx)(eh.Z,{className:"w-4 h-4 text-ged-secondary"}):null]},e.name)})}),(0,a.jsx)("div",{className:"flex justify-end pt-2",children:(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",children:"Fermer"})})]})]})}function ey(e){let{onClose:t}=e,{state:s,actions:r}=(0,y.q)(),[i,c]=(0,l.useState)(""),[o,m]=(0,l.useState)("#3b82f6"),[x,u]=(0,l.useState)(!1),[h,g]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),v=async e=>{if(e.preventDefault(),i.trim()){u(!0),N(null);try{await r.createTag(i.trim(),o),c("")}catch(e){N(e instanceof Error?e.message:"Erreur")}finally{u(!1)}}},w=async e=>{g(e);try{await r.deleteTag(e)}finally{g(null)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-ged-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-ged-accent/10 rounded-lg",children:(0,a.jsx)(n.Z,{className:"w-5 h-5 text-ged-accent"})}),(0,a.jsx)("h2",{className:"font-display font-semibold text-lg",children:"G\xe9rer les \xe9tiquettes"})]}),(0,a.jsx)("button",{onClick:t,className:"btn-icon",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("form",{onSubmit:v,className:"space-y-3",children:[j&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:[(0,a.jsx)(ex.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:j})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Nom de l'\xe9tiquette",className:"input flex-1",disabled:x}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:!i.trim()||x,children:x?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(d.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:["#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#a855f7","#ec4899"].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>m(e),className:"w-6 h-6 rounded-full ".concat(o===e?"ring-2 ring-offset-2 ring-ged-primary":""),style:{backgroundColor:e}},e))})]}),(0,a.jsxs)("div",{className:"border-t border-ged-border pt-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-ged-text-muted mb-3",children:"Existantes"}),0===s.availableTags.length?(0,a.jsx)("p",{className:"text-center py-4 text-ged-text-muted text-sm",children:"Aucune"}):(0,a.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:s.availableTags.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-ged-surface",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"flex-1 font-medium",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-ged-text-muted bg-white px-2 py-0.5 rounded-full",children:e.count}),(0,a.jsx)("button",{onClick:()=>w(e.name),disabled:h===e.name,className:"p-1 text-ged-text-muted hover:text-red-500",children:h===e.name?(0,a.jsx)(f.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]},e.name))})]}),(0,a.jsx)("div",{className:"flex justify-end pt-2",children:(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary",children:"Fermer"})})]})]})}function ek(){return(0,a.jsxs)("div",{className:"h-[100dvh] flex flex-col overflow-hidden",children:[(0,a.jsx)(Z,{}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[(0,a.jsx)(D,{}),(0,a.jsx)("main",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:(0,a.jsx)(K,{})})]}),(0,a.jsx)(em,{}),(0,a.jsx)(ep,{})]})}}},function(e){e.O(0,[48,141,971,117,744],function(){return e(e.s=4810)}),_N_E=e.O()}]);