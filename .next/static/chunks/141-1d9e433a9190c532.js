"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{1837:function(e,a,t){t.d(a,{IM:function(){return d},L6:function(){return S},NJ:function(){return h},Ni:function(){return U},Pn:function(){return O},Rt:function(){return y},UE:function(){return m},W8:function(){return u},_l:function(){return D},a3:function(){return N},gr:function(){return w},j2:function(){return T},jJ:function(){return g},km:function(){return _},ln:function(){return C},oH:function(){return v},pC:function(){return R},qt:function(){return i},sv:function(){return E},uo:function(){return A},wJ:function(){return L},wz:function(){return f},xu:function(){return p},yC:function(){return I}});let n=["http://192.168.1.100:8000","http://localhost:8000"];function r(){var e;try{let e=localStorage.getItem("ged-api-urls");if(e){let a=JSON.parse(e);if(Array.isArray(a)&&a.length>0)return a}}catch(e){}return(null===(e=window.__ENV__)||void 0===e?void 0:e.API_URLS)&&Array.isArray(window.__ENV__.API_URLS)&&window.__ENV__.API_URLS.length>0?window.__ENV__.API_URLS:n}let o=null;async function c(){if(o)return o;let e=r();for(let a of e)try{let e=new AbortController,t=setTimeout(()=>e.abort(),2e3),n=await fetch("".concat(a,"/health"),{signal:e.signal});if(clearTimeout(t),n.ok)return console.log("API d\xe9tect\xe9e sur: ".concat(a)),o=a,a}catch(e){console.log("API non disponible sur: ".concat(a))}return console.warn("Aucune API d\xe9tect\xe9e, utilisation de l'URL par d\xe9faut"),o=e[0]}function i(){return o}async function s(e,a){let t=await c(),n="".concat(t).concat(e),r=await fetch(n,{...a,headers:{"Content-Type":"application/json",...null==a?void 0:a.headers}});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Erreur inconnue"}))).detail||"Erreur ".concat(r.status));return r.json()}async function l(e,a){let t=await c(),n="".concat(t).concat(e),r=await fetch(n,{method:"POST",body:a});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Erreur inconnue"}))).detail||"Erreur ".concat(r.status));return r.json()}async function y(){let e=await c(),a=await fetch("".concat(e,"/health"));if(!a.ok)throw Error("API non disponible");return a.json()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return s("/api/tree?max_depth=".concat(e))}async function u(){return s("/api/armoires")}async function E(e){return s("/api/browse/".concat(encodeURIComponent(e)))}async function p(e){return s("/api/armoires",{method:"POST",body:JSON.stringify({name:e})})}async function S(e,a){return s("/api/create/".concat(encodeURIComponent(e)),{method:"POST",body:JSON.stringify({name:a})})}async function T(e,a){let t=new FormData;return a.forEach(e=>t.append("files",e)),l("/api/upload-multiple/".concat(encodeURIComponent(e)),t)}function _(e,a){let t=a||o||r()[0];return"".concat(t,"/api/download/").concat(encodeURIComponent(e))}function R(e,a){let t=a||o||r()[0];return"".concat(t,"/api/preview/").concat(encodeURIComponent(e))}async function m(e,a){return s("/api/rename/".concat(encodeURIComponent(e)),{method:"PUT",body:JSON.stringify({new_name:a})})}async function f(e){return s("/api/delete/".concat(encodeURIComponent(e)),{method:"DELETE"})}async function A(e,a){return s("/api/move/".concat(encodeURIComponent(e)),{method:"PUT",body:JSON.stringify({destination_id:a})})}async function I(e,a){let t=new URLSearchParams({q:e});return(null==a?void 0:a.type)&&t.append("type",a.type),(null==a?void 0:a.extension)&&t.append("extension",a.extension),s("/api/search?".concat(t.toString()))}async function h(){return s("/api/tags")}async function C(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#3b82f6";return s("/api/tags",{method:"POST",body:JSON.stringify({name:e,color:a})})}async function O(e){return s("/api/tags/".concat(encodeURIComponent(e)),{method:"DELETE"})}async function w(e){return s("/api/item/".concat(encodeURIComponent(e),"/tags"))}async function L(e,a){return s("/api/item/".concat(encodeURIComponent(e),"/tags/").concat(encodeURIComponent(a)),{method:"POST"})}async function g(e,a){return s("/api/item/".concat(encodeURIComponent(e),"/tags/").concat(encodeURIComponent(a)),{method:"DELETE"})}async function v(e){return s("/api/tags/".concat(encodeURIComponent(e),"/items"))}async function D(){return s("/api/favorites")}async function N(e){return s("/api/favorites/".concat(encodeURIComponent(e)),{method:"POST"})}async function U(e){return s("/api/favorites/".concat(encodeURIComponent(e)),{method:"DELETE"})}},141:function(e,a,t){t.d(a,{AppProvider:function(){return l},f:function(){return d},q:function(){return y}});var n=t(7437),r=t(2265),o=t(1837);let c={apiConnected:!1,apiChecking:!0,activeUrl:null,armoires:[],rayons:[],classeurs:[],dossiers:[],intercalaires:[],documents:[],favorites:[],availableTags:[],selectedItemTags:[],loading:{armoires:!0,rayons:!1,classeurs:!1,dossiers:!1,intercalaires:!1,documents:!1,tags:!1},selection:{armoire:null,rayon:null,classeur:null,dossier:null,intercalaire:null,document:null},viewMode:"list",sidebarCollapsed:!1,searchQuery:"",searchResults:[],searchLoading:!1,isSearchActive:!1,modal:{type:null},error:null};function i(e,a){switch(a.type){case"SET_API_STATUS":return{...e,apiConnected:a.payload.connected,apiChecking:a.payload.checking,activeUrl:a.payload.activeUrl||e.activeUrl};case"SET_ARMOIRES":return{...e,armoires:a.payload};case"SET_RAYONS":return{...e,rayons:a.payload};case"SET_CLASSEURS":return{...e,classeurs:a.payload};case"SET_DOSSIERS":return{...e,dossiers:a.payload};case"SET_DOCUMENTS":return{...e,documents:a.payload};case"SET_AVAILABLE_TAGS":return{...e,availableTags:a.payload};case"SET_SELECTED_ITEM_TAGS":return{...e,selectedItemTags:a.payload};case"SET_LOADING":return{...e,loading:{...e.loading,[a.payload.key]:a.payload.value}};case"SELECT_ARMOIRE":return{...e,selection:{armoire:a.payload,rayon:null,classeur:null,dossier:null,intercalaire:null,document:null},rayons:[],classeurs:[],dossiers:[],intercalaires:[],documents:[],selectedItemTags:[],isSearchActive:!1,searchQuery:"",searchResults:[]};case"SELECT_RAYON":return{...e,selection:{...e.selection,rayon:a.payload,classeur:null,dossier:null,intercalaire:null,document:null},classeurs:[],dossiers:[],intercalaires:[],documents:[],selectedItemTags:[]};case"SELECT_CLASSEUR":return{...e,selection:{...e.selection,classeur:a.payload,dossier:null,intercalaire:null,document:null},dossiers:[],intercalaires:[],documents:[],selectedItemTags:[]};case"SELECT_DOSSIER":return{...e,selection:{...e.selection,dossier:a.payload,intercalaire:null,document:null},intercalaires:[],documents:[],selectedItemTags:[]};case"SET_INTERCALAIRES":return{...e,intercalaires:a.payload};case"SELECT_INTERCALAIRE":return{...e,selection:{...e.selection,intercalaire:a.payload,document:null},documents:[],selectedItemTags:[]};case"SELECT_DOCUMENT":return{...e,selection:{...e.selection,document:a.payload}};case"SET_VIEW_MODE":return{...e,viewMode:a.payload};case"TOGGLE_SIDEBAR":return{...e,sidebarCollapsed:!e.sidebarCollapsed};case"SET_SEARCH_QUERY":return{...e,searchQuery:a.payload};case"SET_SEARCH_RESULTS":return{...e,searchResults:a.payload};case"SET_SEARCH_LOADING":return{...e,searchLoading:a.payload};case"SET_SEARCH_ACTIVE":return{...e,isSearchActive:a.payload};case"SHOW_MODAL":return{...e,modal:{type:a.payload.type,data:a.payload.data}};case"HIDE_MODAL":return{...e,modal:{type:null}};case"SET_ERROR":return{...e,error:a.payload};case"CLEAR_ERROR":return{...e,error:null};case"ADD_FAVORITE":if(e.favorites.some(e=>e.id===a.payload.id))return e;return{...e,favorites:[...e.favorites,a.payload]};case"REMOVE_FAVORITE":return{...e,favorites:e.favorites.filter(e=>e.id!==a.payload)};case"SET_FAVORITES":return{...e,favorites:a.payload};default:return e}}let s=(0,r.createContext)(null);function l(e){let{children:a}=e,[t,l]=(0,r.useReducer)(i,c),y=async()=>{try{let e=await o._l();l({type:"SET_FAVORITES",payload:e})}catch(e){console.error("Erreur chargement favoris:",e);try{let e=localStorage.getItem("ged-favorites");e&&l({type:"SET_FAVORITES",payload:JSON.parse(e)})}catch(e){}}};(0,r.useEffect)(()=>{(async()=>{try{await o.Rt();let e=o.qt();l({type:"SET_API_STATUS",payload:{connected:!0,checking:!1,activeUrl:e}})}catch(e){l({type:"SET_API_STATUS",payload:{connected:!1,checking:!1,activeUrl:null}})}})()},[]);let d=async()=>{l({type:"SET_LOADING",payload:{key:"armoires",value:!0}});try{let e=await o.W8();l({type:"SET_ARMOIRES",payload:e})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger les armoires"})}finally{l({type:"SET_LOADING",payload:{key:"armoires",value:!1}})}},u=async()=>{l({type:"SET_LOADING",payload:{key:"tags",value:!0}});try{let e=await o.NJ();l({type:"SET_AVAILABLE_TAGS",payload:e})}catch(e){console.error("Erreur chargement tags:",e)}finally{l({type:"SET_LOADING",payload:{key:"tags",value:!1}})}},E=async e=>{if(l({type:"SELECT_ARMOIRE",payload:e}),e){l({type:"SET_LOADING",payload:{key:"rayons",value:!0}});try{let a=await o.sv(e.id);l({type:"SET_RAYONS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger les rayons"})}finally{l({type:"SET_LOADING",payload:{key:"rayons",value:!1}})}}},p=async e=>{if(l({type:"SELECT_RAYON",payload:e}),e){l({type:"SET_LOADING",payload:{key:"classeurs",value:!0}});try{let a=await o.sv(e.id);l({type:"SET_CLASSEURS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger les classeurs"})}finally{l({type:"SET_LOADING",payload:{key:"classeurs",value:!1}})}}},S=async e=>{if(l({type:"SELECT_CLASSEUR",payload:e}),e){l({type:"SET_LOADING",payload:{key:"dossiers",value:!0}});try{let a=await o.sv(e.id);l({type:"SET_DOSSIERS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger les dossiers"})}finally{l({type:"SET_LOADING",payload:{key:"dossiers",value:!1}})}}},T=async e=>{if(l({type:"SELECT_DOSSIER",payload:e}),e){l({type:"SET_LOADING",payload:{key:"intercalaires",value:!0}}),l({type:"SET_LOADING",payload:{key:"documents",value:!0}});try{let a=await o.sv(e.id),t=a.filter(e=>!e.extension&&"document"!==e.type),n=a.filter(e=>e.extension||"document"===e.type);l({type:"SET_INTERCALAIRES",payload:t}),0===t.length?l({type:"SET_DOCUMENTS",payload:n}):l({type:"SET_DOCUMENTS",payload:[]})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger le contenu"})}finally{l({type:"SET_LOADING",payload:{key:"intercalaires",value:!1}}),l({type:"SET_LOADING",payload:{key:"documents",value:!1}})}}},_=async e=>{if(l({type:"SELECT_INTERCALAIRE",payload:e}),e){l({type:"SET_LOADING",payload:{key:"documents",value:!0}});try{let a=await o.sv(e.id);l({type:"SET_DOCUMENTS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Impossible de charger les documents"})}finally{l({type:"SET_LOADING",payload:{key:"documents",value:!1}})}}else l({type:"SET_DOCUMENTS",payload:[]})},R=async e=>{if(l({type:"SELECT_DOCUMENT",payload:e}),e)try{let a=await o.gr(e.id);l({type:"SET_SELECTED_ITEM_TAGS",payload:a})}catch(e){l({type:"SET_SELECTED_ITEM_TAGS",payload:[]})}else l({type:"SET_SELECTED_ITEM_TAGS",payload:[]})},m=async(e,a,n)=>{try{"armoire"===n?(await o.xu(a),await d()):e&&(await o.L6(e,a),"rayon"===n&&t.selection.armoire?await E(t.selection.armoire):"classeur"===n&&t.selection.rayon?await p(t.selection.rayon):"dossier"===n&&t.selection.classeur?await S(t.selection.classeur):"intercalaire"===n&&t.selection.dossier&&await T(t.selection.dossier)),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de cr\xe9ation"}),e}},f=async(e,a)=>{try{await o.j2(e,a),t.selection.intercalaire?await _(t.selection.intercalaire):t.selection.dossier&&await T(t.selection.dossier),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur d'upload"}),e}},A=async(e,a)=>{try{await o.wz(e),"document"===a&&l({type:"REMOVE_FAVORITE",payload:e}),await u(),"armoire"===a?(await d(),l({type:"SELECT_ARMOIRE",payload:null})):"rayon"===a&&t.selection.armoire?await E(t.selection.armoire):"classeur"===a&&t.selection.rayon?await p(t.selection.rayon):"dossier"===a&&t.selection.classeur?await S(t.selection.classeur):"intercalaire"===a&&t.selection.dossier?(await T(t.selection.dossier),l({type:"SELECT_INTERCALAIRE",payload:null})):"document"===a&&(t.selection.intercalaire?await _(t.selection.intercalaire):t.selection.dossier&&await T(t.selection.dossier),l({type:"SELECT_DOCUMENT",payload:null})),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de suppression"}),e}},I=async(e,a,t)=>{try{await o.UE(e,a),await w(),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de renommage"}),e}},h=async(e,a)=>{try{await o.uo(e,a),await w(),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de d\xe9placement"}),e}},C=async()=>{try{return await o.IM()}catch(e){return console.error("Erreur getTree",e),[]}},O=async e=>{if(l({type:"SET_SEARCH_QUERY",payload:e}),e.length<2){l({type:"SET_SEARCH_RESULTS",payload:[]}),l({type:"SET_SEARCH_ACTIVE",payload:!1});return}l({type:"SET_SEARCH_LOADING",payload:!0}),l({type:"SET_SEARCH_ACTIVE",payload:!0});try{let a=await o.yC(e);l({type:"SET_SEARCH_RESULTS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Erreur de recherche"})}finally{l({type:"SET_SEARCH_LOADING",payload:!1})}},w=async()=>{if(await d(),await u(),t.selection.armoire&&l({type:"SET_RAYONS",payload:await o.sv(t.selection.armoire.id)}),t.selection.rayon&&l({type:"SET_CLASSEURS",payload:await o.sv(t.selection.rayon.id)}),t.selection.classeur&&l({type:"SET_DOSSIERS",payload:await o.sv(t.selection.classeur.id)}),t.selection.dossier){let e=await o.sv(t.selection.dossier.id),a=e.filter(e=>!e.extension&&"document"!==e.type),n=e.filter(e=>e.extension||"document"===e.type);l({type:"SET_INTERCALAIRES",payload:a}),t.selection.intercalaire?l({type:"SET_DOCUMENTS",payload:await o.sv(t.selection.intercalaire.id)}):0===a.length?l({type:"SET_DOCUMENTS",payload:n}):l({type:"SET_DOCUMENTS",payload:[]})}},L=async(e,a)=>{try{await o.ln(e,a),await u(),l({type:"HIDE_MODAL"})}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de cr\xe9ation"}),e}},g=async e=>{try{await o.Pn(e),await u()}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur de suppression"}),e}},v=async e=>{try{let a=await o.gr(e);l({type:"SET_SELECTED_ITEM_TAGS",payload:a})}catch(e){l({type:"SET_SELECTED_ITEM_TAGS",payload:[]})}},D=async(e,a)=>{try{let t=await o.wJ(e,a);l({type:"SET_SELECTED_ITEM_TAGS",payload:t.tags}),await u()}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur"}),e}},N=async(e,a)=>{try{let t=await o.jJ(e,a);l({type:"SET_SELECTED_ITEM_TAGS",payload:t.tags}),await u()}catch(e){throw l({type:"SET_ERROR",payload:e instanceof Error?e.message:"Erreur"}),e}},U=async e=>{l({type:"SET_SEARCH_LOADING",payload:!0}),l({type:"SET_SEARCH_ACTIVE",payload:!0}),l({type:"SET_SEARCH_QUERY",payload:"tag:".concat(e)});try{let a=await o.oH(e);l({type:"SET_SEARCH_RESULTS",payload:a})}catch(e){l({type:"SET_ERROR",payload:"Erreur de filtrage"})}finally{l({type:"SET_SEARCH_LOADING",payload:!1})}},M=async e=>{l({type:"ADD_FAVORITE",payload:e});try{await o.a3(e.id)}catch(a){console.error("Erreur ajout favori:",a),l({type:"REMOVE_FAVORITE",payload:e.id})}},G=async e=>{let a=t.favorites;l({type:"REMOVE_FAVORITE",payload:e});try{await o.Ni(e)}catch(e){console.error("Erreur suppression favori:",e),l({type:"SET_FAVORITES",payload:a})}};return(0,r.useEffect)(()=>{t.apiConnected&&(d(),u(),y())},[t.apiConnected]),(0,n.jsx)(s.Provider,{value:{state:t,dispatch:l,actions:{loadArmoires:d,selectArmoire:E,selectRayon:p,selectClasseur:S,selectDossier:T,selectIntercalaire:_,selectDocument:R,createItem:m,moveItem:h,getTree:C,uploadFiles:f,deleteItem:A,renameItem:I,search:O,clearSearch:()=>{l({type:"SET_SEARCH_QUERY",payload:""}),l({type:"SET_SEARCH_RESULTS",payload:[]}),l({type:"SET_SEARCH_ACTIVE",payload:!1})},refresh:w,loadTags:u,createTag:L,deleteTag:g,loadItemTags:v,addTagToItem:D,removeTagFromItem:N,filterByTag:U,addFavorite:M,removeFavorite:G,isFavorite:e=>t.favorites.some(a=>a.id===e)}},children:a})}function y(){let e=(0,r.useContext)(s);if(!e)throw Error("useApp must be used within an AppProvider");return e}function d(){let{state:e}=y(),{selection:a}=e,t=[];return a.armoire&&t.push({id:a.armoire.id,name:a.armoire.name,level:"armoire"}),a.rayon&&t.push({id:a.rayon.id,name:a.rayon.name,level:"rayon"}),a.classeur&&t.push({id:a.classeur.id,name:a.classeur.name,level:"classeur"}),a.dossier&&t.push({id:a.dossier.id,name:a.dossier.name,level:"dossier"}),a.intercalaire&&t.push({id:a.intercalaire.id,name:a.intercalaire.name,level:"intercalaire"}),a.document&&t.push({id:a.document.id,name:a.document.name,level:"document"}),t}}}]);